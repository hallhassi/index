<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            height:100000px;
            margin: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: block;
            z-index: -1;
            object-fit: cover; 
        }

        .text-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        #spacer {
            height: 500vh;
        }
    </style>
</head>
<body>

    <div class="text-container">scroll</div>
    <canvas id="anim-canvas"></canvas>
    <div id="spacer"></div> 

    <script>
    const canvas = document.getElementById('anim-canvas');
    const ctx = canvas.getContext('2d');
    
    const settings = {
        totalFrames: 2001,
        perSheet: 100,
        isMobile: window.innerWidth < 768,
        // Match these to the actual source image dimensions in your spritesheet
        sourceWidth: window.innerWidth < 768 ? 300 : 600,
        sourceHeight: window.innerWidth < 768 ? 300 : 600
    };
    
    let loadedSheets = {};

    // Update canvas internal resolution to match the window
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        render(window.scrollY / (document.documentElement.scrollHeight - window.innerHeight));
    }

    window.addEventListener('resize', resize);
    resize();
    
    function render(scrollFraction) {
        const frameIndex = Math.min(
            settings.totalFrames - 1,
            Math.max(0, Math.floor(scrollFraction * settings.totalFrames))
        );
    
        const sheetIndex = Math.floor(frameIndex / settings.perSheet);
        const indexInSheet = frameIndex % settings.perSheet;
        const mode = settings.isMobile ? 'mobile' : 'desktop';
        const sheetUrl = `./output/${mode}_sheet_${sheetIndex}.jpg`;
    
        if (!loadedSheets[sheetUrl]) {
            const img = new Image();
            img.src = sheetUrl;
            img.onload = () => {
                loadedSheets[sheetUrl] = img;
                drawFrame(img, indexInSheet);
            };
        } else {
            drawFrame(loadedSheets[sheetUrl], indexInSheet);
        }
    }
    
    function drawFrame(image, index) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Calculate aspect ratio to "Cover" the screen (similar to background-size: cover)
        const scale = Math.max(canvas.width / settings.sourceWidth, canvas.height / settings.sourceHeight);
        const x = (canvas.width / 2) - (settings.sourceWidth / 2) * scale;
        const y = (canvas.height / 2) - (settings.sourceHeight / 2) * scale;

        ctx.drawImage(
            image, 
            0, index * settings.sourceHeight, settings.sourceWidth, settings.sourceHeight, // Source
            x, y, settings.sourceWidth * scale, settings.sourceHeight * scale // Destination
        );
    }
    
    window.addEventListener('scroll', () => {
        const scrollTop = window.scrollY;
        const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
        const scrollFraction = scrollTop / maxScroll;
        
        requestAnimationFrame(() => render(scrollFraction));
    });
    
    render(0);
    </script>
</body>
</html>